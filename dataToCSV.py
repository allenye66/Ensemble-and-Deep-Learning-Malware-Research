import csv
import os

def countOpcodes(filename):
	with open(filename) as f:
			s = set()
			for word in f:
				s.add(word.rstrip())
	#s = getUniqueOpcodes(filename)
		#print(s)
		#print(len(s))

	d = {}
	for word in s:
		d[word] = 0
	with open(filename) as f:
		for word in f:
			word = word.rstrip()
			d[word] += 1

	d=sorted(d.items(), key=lambda x: x[1], reverse = True)
	#print(d)
	#print(type(d))

	arr = []
	for key, value in d:
	    arr.append(key)


	return arr,d
		#print(d)


#problem, each file has diff opcodes
#traverse through each text file adding the opcodes to a set and make that set part of the header
#if an opcode in the header is not in the dict list, set the dict list to 0
if __name__ == '__main__':
	filename = '/Users/allen/Desktop/ExtractedOpcodes/zbot_opcodes/VirusShare_8ed025c40fbddd4390f0a266a8f9023b.txt'
	header, dictionary = countOpcodes(filename)
	print(header)
	with open('zbot.csv', 'w') as g:

	        writer = csv.writer(g)
	       	header.insert(0, 'Total Opcodes')
	        header.insert(0, 'Family')
	        #print(header)
	        writer.writerow(header)
	        #for filename in os.listdir('/Users/allen/Desktop/ExtractedOpcodes/zbot_opcodes'):


	        #for every file inside zbot folder:
	        	#count the opcodes and add a new row