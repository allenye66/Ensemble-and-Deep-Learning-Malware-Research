import r2pipe
import processOutput_pd
import processOutput_pda
from processOutput_pda import process_pda, processOpcodes_pda
from processOutput_pd import process, processOpcodes
from os import listdir
import os

def iterate(foldername):
	for f in listdir(foldername):
 		print(f)
def extract_write(filename):
	r = r2pipe.open(filename)
	##any command that one runs in the r2 shell can be passed to the cmd method
	#print(r.cmd('pd'))
	#print(r.cmd('v'))
	#print(r.cmd)
	#s = r.cmd("pd[dD]")
	#pd > output.txt #for terminal


	#s = r.cmd("pd 400") #find better way to do this

	file_size = os.path.getsize(filename)
	command = "pD " + str(file_size)
	print("********************", command) 
	#s = r.cmd(command) # THIS IS DISASSEMBLE? IS IT CORRECT?

	#s = r.cmd("pda")


	r.cmd('aaa')
	s = r.cmd("pdf @@f")
	print(s)



	#print(s)


	## r.cmd("pD (filesize)")
		#find filesize with wc -c < "filename"

	##create new text file name
	slash = filename.rfind("/")
	#print(slash)
	txt_file = filename[slash + 1:] + ".txt"
	full_directory = "/Users/allen/Desktop/Malware-Research/processed_data/"
	#xt_file = temp_s + txt_file
	#print(txt_file)
	#print(txt_file)

	f = open(os.path.join("/Users/allen/Desktop/Malware-Research/processed_data/",txt_file), "w+")
	f.write(s)
	f.close()
	return (str(full_directory + txt_file))
	#return ('"%s"' % str(txt_file))


	#f = open("output.txt", "w") #create new text file and write to it
	#f.write(s)
	#f.close()

if __name__ == "__main__":
	
	#print((extract_write("/Users/allen/Desktop/v001/VirusShare_fffb1996a5b7c4c716931af2842712e3")))
	s = ((extract_write("/Users/allen/Desktop/v001.1/VirusShare_fda3e6a6a8378f7cdb1369c0a8cf599d")))
	#s = ((extract_write("/Users/allen/Desktop/v001.5/VirusShare_fffb1996a5b7c4c716931af2842712e3"))) 
	#print(s)
	#process_pda(s)
	#processOpcodes_pda(s)
	process(s)
	processOpcodes(s)
	#process("VirusShare_fffb1996a5b7c4c716931af2842712e3.txt")	
	#iterate("/Users/allen/Desktop/v001.5")